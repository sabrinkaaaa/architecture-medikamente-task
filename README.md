# architecture-medikamente

### О компании
Компания «Медикаменте» предоставляет медицинские услуги. Сейчас у компании есть один офис, в котором работают 20 административных сотрудников и 15 медицинских специалистов.

Все операции с данными команда производит вручную.

Журналы приёма пациентов, учёт пациентов и платежей, медицинские карты, учёт анализов ― в файлах Excel или хранят в виде сканов. Материалы лежат на общем диске.

Учёт денежных средств — в «1С:Бухгалтерия предприятия». С ней интегрированы контрольно-кассовые машины (ККМ).

Учёт товарно-материальных ценностей (ТМЦ) — в «1С:Торговля и склад». Программа интегрирована с «1С:Бухгалтерия предприятия».

В этом году компания собирается открывать новые филиалы. Руководство ожидает, что число клиентов кратно возрастёт. 

Ваша задача — автоматизировать всю работу таким образом, чтобы компания смогла поддержать пятикратный рост объёма данных и расширение команды.

Поскольку «Медикаменте» будет активно нанимать новых сотрудников, необходимо усилить безопасность медицинских карт. Они содержат конфиденциальные данные, которые необходимо защитить от несанкционированного доступа и утечек.

В будущем компания хочет уйти от ручной записи клиентов и перейти на единую систему хранения и управления данными. Она объединит журналы приёма пациентов, учёт пациентов и учёт оплаты услуг. Планируется, что система будет поддерживать мобильное приложение, в котором клиенты смогут самостоятельно записаться к врачу через личный кабинет (ЛК).

#### Проблемы компании
Компания обслуживает пациентов на территории Российской Федерации. Технический директор «Медикаменте» видит, что работа с конфиденциальными данными и PII не в полной мере отвечает требованиям российского законодательства. Это создаёт репутационные и финансовые риски для компании. Если информация о нарушениях дойдёт до СМИ, «Медикаменте» потеряет доверие клиентов.

Исходя из этого, технический директор сформулировал две бизнес-потребности. 
- Изменить парадигму хранения и учёта конфиденциальных данных. Она должна соответствовать принципам и требованиям законодательства РФ.
- Снизить риски утечки данных, чтобы увеличить доверие и лояльность клиентов.

#### Лендскейп компании

В «Медикаменте» шесть отделов:
- Медицинские специалисты — 15 человек.
- Ресепшен — 3 сотрудника. Ведут журнал записей к специалистам и заключают клиентские контракты.
- Кассиры — 3 сотрудника. Принимают платежи и ведут двойной учёт в Excel и 1C.
- Бухгалтерия — 3 сотрудника. Занимаются процессингом платежей и ведут бухгалтерию, которая связана с учётом кадров, выплатой зарплат и налогами.
- Склад — 3 сотрудника. Ведут учёт ТМЦ и закупок оборудования для медицинских кабинетов.
- IT-отдел — 3 специалиста: технический директор, администратор сети и бизнес-аналитик.

- Технический директор выполняет функции архитектора. В его стек входят Java, Postgres, ClickHouse, Elastic, Kubernetes и --Victoria Metrics.
- Администратор сети может всё ― от починки принтера до развёртывания кластера Kubernetes.
- Бизнес-аналитик умеет строить отчёты (P&L, ABC-анализ и другие) на основе Excel при помощи Jupiter и Python.

В рамках расширения бизнеса «Медикаменте» планирует открывать активный наём и увеличивать команду. Если для автоматизации процессов и усиления безопасности данных нужны новые сотрудники, руководство выделит необходимые ресурсы.

### Текущее состояние архитектуры

У технологической базы компании довольно простой ландшафт. Есть несколько бэк-офис-сервисов, которые закрывают разные потребности. Все IT-продукты построены на разных архитектурных принципах (монолит, общие ресурсы) и развёрнуты на собственном сервере компании. Он находится в том же здании, что и офис.

Технологический стек компании выглядит так:
- Excel, Outlook и 1С. Их используют для работы на компьютерах в локальной сети компании.
«1С:Бухгалтерия предприятия». Программа работает в файловом режиме. Её используют для учёта платежей, начисления зарплаты, кадрового учёта и подготовки документации для налоговых органов.
- «1С:Торговля и склад». Тоже работает в файловом режиме. В этой программе ведут учёт товарно-материальных ценностей (ТМЦ).
- Физический сервер с Microsoft Windows Server 2022. На нём настроены Active Directory, DNS, DHCP, LDAP, файловый сервер, Exchange Mail Server. ККМ связаны с сервером через TCP/IP и компоненту 1С по технологии OLE.

Вот диаграмма с архитектурой системы в модели C4:

<img width="1859" height="1739" alt="Image" src="https://github.com/user-attachments/assets/96d44eba-63c4-4fc0-a300-c3c667089880" />

#### Принципы работы с данными

Любой бизнес-процесс в компании сопровождается обращением к конфиденциальным данным разного уровня.

При взаимодействии с персоналом медицинского центра пациент указывает персональные данные, в том числе ― Ф. И. О., дату рождения, телефон и электронную почту. Ещё он может заполнить расширенную форму, которая включает вопросы об адресе прописки, месте работы или учёбы, хронических заболеваниях. Всю эту информацию сотрудники обрабатывают вручную.

«Медикаменте» использует локальные способы хранения данных. В основном это Excel, JPG и PDF. Результаты работы с данными сохраняются и читаются в файлах и IT-системах без аудита действий.

Внутренние потоки данных между IT-продуктами никак не контролируются. Ограничения по передаваемым данным обусловлены только бизнес-процессами компании. Кроме доменной аутентификации, со стороны систем обработки нет ограничений на доступ к данным.

### Цели бизнеса
Компания стремится обеспечить конфиденциальность, целостность и доступность данных — это приоритет «Медикаменте», который диктует подход к остальным трём целям компании. 

1. Интеграция лаборатории анализов с API.

«Медикаменте» хочет настроить интеграцию лаборатории анализов с API. Требования к интеграции такие:
- API-контракты должны закрывать и скрывать категории данных, которые явно представляют конфиденциальные данные.
- Необходимо предотвратить использование API-контрактов, позволяющих третьим лицам выполнять действия и получать данные внешним пользователям, которые они не должны иметь возможности получить. Например, один пациент не должен иметь возможность увидеть данные другого пациента.
- В будущем компания планирует развивать сервисы для клиентов, в том числе за счёт интеграций с партнёрами. Поэтому необходимо выстроить такой подход к работе с данными по умолчанию, чтобы новые интеграции не приходилось перевалидировать.

2. Расширение направления обработки данных (новые сервисы на базе BI-, ML- и AI-технологий).

Компания накапливает данные, которые можно использовать для ведения бизнеса, извлекая из них знания и реализуя новые сервисы.

Сейчас сотрудникам очень неудобно обрабатывать данные, которые хранятся в Excel-файлах, так как такой формат подразумевает много ручной работы. Поэтому необходимо создать на основе этих файлов озеро данных, которое позволит автоматизировать построение BI, создание LLM и обучение AI на этих данных с применением ML.

3. Разработка новых систем и миграция.

Чтобы автоматизировать процессы, компания планирует разработать:
- портал для клиентов,
- gортал для сотрудников ресепшена,
- платёжный шлюз,
- CRM для сбора данных о клиентах,
- интеграцию с лабораторией анализов.

Промежуточное состояние (через пару месяцев). MVP, в котором клиент сможет самостоятельно записаться на приём к специалисту через портал компании. При этом команда ресепшена будет видеть эту запись: сотрудники смогут отследить запись в системе и за день до приёма напомнить про него и пациенту, и специалисту. Необходимо определить категории данных пациентов и разнести их по различным доменам. Для каждой категории данных определить роли (RBAC) или атрибуты (ABAC), на основании которых сотрудникам будет разрешён доступ к данным.

Финальное состояние (через год). Полностью автоматический процесс записи к специалисту через портал и мобильное приложение. Пациенту приходят оповещения о записи через мобильное приложение или голосового робота. В ответ на оповещение клиент может подтвердить или отменить запись, при этом система отправляет оповещение на ресепшен. В мобильном приложении пациент может просматривать только свои данные (анализы, заключения, договор), у него нет доступа к данным других пациентов. В системе есть возможность помечать тегами данные, которые необходимо защитить. Релиз проверяется в автоматическом режиме на работу с тегированными данными, после чего информация передаётся в систему мониторинга и алертинга. В системе появилась возможность проводить аудит доступа к данным и отслеживать нетипичные действия пользователей. В случае несанкционированного доступа к данным команде приходят оповещения.

При разработке решения необходимо обеспечить следующие НФТ:
- Безопасность (конфиденциальность). Необходима гарантия того, что чувствительная информация будет безопасно храниться и обрабатываться. Чувствительные данные важно своевременно удалять. Если клиент обратится с соответствующим запросом, обработку его данных нужно прекратить.
- Масштабируемость. Система должна стабильно работать в условиях расширения бизнеса: компания открывает филиалы, нанимает десятки сотрудников и даёт клиентам возможность работать через мобильное приложение.
Сопровождаемость. Нужно предусмотреть внесение изменений и улучшений в систему. Этот процесс должен быть простым и понятным.
- Конфигурируемость. В конфигурации можно вносить изменения без дополнительных доработок.

## Задания

### Задание 1. Анализ безопасности системы

Чтобы заниматься реализацией новых продуктов, которые основаны на данных, необходимо системно решить проблему хранения конфиденциальных данных и управления ими. Сейчас данные лежат в непосредственной близости к пользователям, поэтому существует риск утечки данных и неправомерного использования информации.

Чтобы защитить данные, используйте механизмы, инструменты и принципы работы с конфиденциальными данными, например, подходы Privacy By Design, Data Minimization и Data Lineage.

В рамках этого задания вам нужно проанализировать состояние As-Is, чтобы впоследствии приступить к его доработке.

#### Что нужно сделать

1. Выявите конфиденциальные данные, которые не учтены во внутренних системах.
- Проанализируйте информацию о компании.
- Создайте диаграммы потоков данных (Data Flow Diagrams). Для каждого процесса создайте отдельную диаграмму.
- Отобразите на них, как данные перемещаются по системам компании и какие операции над ними совершают.

2. Проведите аудит мер по обеспечению безопасности данных.
- Сопоставьте процессы в компании с требованиями по обеспечению безопасности данных и архитектурными практиками в области безопасности конфиденциальных данных.
- Составьте список проблемных зон и сохраните его в отдельный документ.

3. Подумайте, что можно улучшить.
- Составьте список данных для защиты и проставьте для каждого способы защиты — шифрование, обфускация, обезличивание.
- Разработайте механизм тегирования данных с использованием инструментов тегирования.
- Составьте список инструментов, способов и мер, которые позволят обеспечить конфиденциальность данных в указанных потоках.
- Доработайте диаграммы из предыдущего шага: отобразите на них, что следует использовать на каждом этапе потока.

При работе над диаграммами потоков данных ориентируйтесь на рекомендации, которые мы дали в уроке «Как управлять потоками данных», и [гайд от Lucidchard](https://www.lucidchart.com/blog/data-flow-diagram-tutorial).

Когда задание будет готово, загрузите диаграммы потоков данных и список проблем в директорию Task1 в рамках пул-реквеста.

### Задание 2. Проектирование решения

Используя подход Privacy by Design, проведите анализ и предложите механизмы для предупреждения возможных рисков, связанных с конфиденциальностью. Ваша задача — спроектировать механизмы управления такими рисками до момента реализации изменений в проектируемой системе.

В рамках этого задания вам нужно проанализировать состояние As-Is и оценить, как спроектировать решение с учётом требований To-Be.

#### Что нужно сделать

1. Предложить новые блоки в архитектуру проектируемой системе С4, которые обеспечат соблюдение принципов Privacy By Design во многих блоках реализуемой системы.

2. Предложить в целевой архитектуре слой, который обеспечивает аналитическую работу с данными системы с учётом принципов Privacy by Design.

Когда задание будет готово, загрузите диаграмму контекста C4 целевого состояния системы в директорию Task2 в рамках пул-реквеста.

### Задание 3. Оценка Data Encryption at Rest and In Transit

Вам необходимо разработать стратегию защиты данных в рамках всей системы. При этом важно учесть особенности шифрования данных, которые находятся в разных состояниях — при хранении и во время передачи. 

#### Что нужно сделать

1. Определить, какие данные нужно защитить. 

Необходимо классифицировать информацию по состоянию, чувствительности, профилю риска и другим параметрам. Это поможет выбрать наиболее эффективные методы защиты.

2. Реализовать базовые инструменты защиты.

Предложить инструменты защиты, которые нужно добавить в систему, чтобы обеспечить защиту данных.

3. Использовать автоматизированный контроль. 

Предложить средства для контроля за данными

4. Подготовить реестр программных и аппаратных средств для защиты данных.

В результате подготовьте классификацию данных, обоснование необходимости защиты выделенных классов и инструменты защиты данных.

| **Данные**   | **В чём необходимость защиты**  | **Инструменты защиты** |
| ------------ | -------------------------------| ---------------------- |


### Задание 4. Оценка узких мест при миграции

В компании планируется миграция устаревшей монолитной системы на современную архитектуру (например, на микросервисную). В процессе перехода необходимо выявить потенциально узкие места, которые могут негативно повлиять на работоспособность нового решения.

#### Что нужно сделать

1. Проанализировать ситуацию.
- Изучить описание текущей системы и целей миграции.
- Определить ключевые процессы и компоненты, затрагиваемые миграцией (например, базы данных, коммуникационные каналы, серверное оборудование, бизнес-логика).
2. Построить диаграмму Исикавы.

Построить диаграмму «Рыбья кость» (Ishikawa) для выявления потенциальных причин узких мест.

3. Выделить основные категории и для каждой указать возможные проблемы.

Например, «Инфраструктура», «Программное обеспечение», «Интеграция», «Персонал», «Процессы».

4. Предложить рекомендации.
- Составить краткий список мер по устранению выявленных узких мест на основе диаграммы.
- Оценить приоритетность этих мер.

5. Сформировать отчёт.
- Представить диаграмму Исикавы (draw.io).
- Описать выявленные проблемы и предложенные решения в виде отчёта. Ревьюер будет смотреть на системность и глубину проработки возможных рисков снижения производительности системы.

Когда задание будет готово, загрузите диаграмму Исикавы в draw.io в директорию Task4 в рамках пул-реквеста.


### Как сдать работу

В директории Task1 должны лежать список проблем компании в разрезе работы с данными и диаграммы потоков данных.

В директории Task2 должна лежать диаграмма контекста в модели C4 c проектом архитектуры MVP.

В директории Task3 таблица с классификацией данных, обоснованием необходимости защиты выделенных классов и инструментами защиты данных.

В директории Task4 диаграмма Исикавы в draw.io.
